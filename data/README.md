# æ•°æ®ç›®å½•è¯´æ˜

æœ¬ç›®å½•ç”¨äºå­˜æ”¾ä¸­æ–‡åŒ»ç–—é—®ç­”ç³»ç»Ÿçš„è®­ç»ƒå’Œè¯„ä¼°æ•°æ®é›†ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ README.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ raw/                         # åŸå§‹æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ medical_qa.json         # åŸå§‹åŒ»ç–—é—®ç­”æ•°æ®ï¼ˆä¸‹è½½åç”Ÿæˆï¼‰
â”‚   â””â”€â”€ sample_data.json        # ç¤ºä¾‹æ•°æ®ï¼ˆæµ‹è¯•ç”¨ï¼‰
â””â”€â”€ processed/                   # é¢„å¤„ç†åçš„æ•°æ®ç›®å½•
    â”œâ”€â”€ train.json              # å®Œæ•´è®­ç»ƒé›†
    â”œâ”€â”€ dev.json                # éªŒè¯é›†
    â”œâ”€â”€ test.json               # æµ‹è¯•é›†
    â”œâ”€â”€ train_1k.json           # 1k æ ·æœ¬è®­ç»ƒé›†
    â”œâ”€â”€ train_5k.json           # 5k æ ·æœ¬è®­ç»ƒé›†
    â””â”€â”€ train_10k.json          # 10k æ ·æœ¬è®­ç»ƒé›†
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

æŒ‰ç…§ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤å‡†å¤‡æ•°æ®ï¼š

```bash
# æ­¥éª¤1ï¼šä¸‹è½½åŸå§‹æ•°æ®
python scripts/download_data.py

# æ­¥éª¤2ï¼šæ•°æ®é¢„å¤„ç†ï¼ˆæ¸…æ´—ã€æ ¼å¼åŒ–ã€åˆ’åˆ†ï¼‰
python scripts/preprocess_data.py

# æ­¥éª¤3ï¼šå‡†å¤‡ä¸åŒè§„æ¨¡çš„è®­ç»ƒé›†
python scripts/prepare_data_splits.py
```

æ‰§è¡Œå®Œæˆåï¼Œ`data/processed/` ç›®å½•å°†åŒ…å«æ‰€æœ‰è®­ç»ƒæ‰€éœ€çš„æ•°æ®æ–‡ä»¶ã€‚

## ğŸ“‹ æ•°æ®å‡†å¤‡è¯¦ç»†è¯´æ˜

### æ­¥éª¤ 1ï¼šä¸‹è½½åŸå§‹æ•°æ®

```bash
python scripts/download_data.py
```

**åŠŸèƒ½**ï¼š
- ä» Hugging Face ä¸‹è½½åŒ»ç–—é—®ç­”æ•°æ®é›†ï¼ˆ`shibing624/medical`ï¼‰
- ä¿å­˜åˆ° `data/raw/medical_qa.json`
- å¦‚æœä¸‹è½½å¤±è´¥ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºç¤ºä¾‹æ•°æ®ç”¨äºæµ‹è¯•

**å¯é€‰å‚æ•°**ï¼š
```bash
# æŒ‡å®šä¿å­˜ç›®å½•
python scripts/download_data.py --save_dir ./data

# ä»…åˆ›å»ºç¤ºä¾‹æ•°æ®ï¼ˆç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰
python scripts/download_data.py --create_sample
```

**å¤‡é€‰æ–¹æ¡ˆ**ï¼š
å¦‚æœè‡ªåŠ¨ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ä»¥ä¸‹æ•°æ®é›†ä¹‹ä¸€ï¼š
- [cMedQA2](https://github.com/zhangsheng93/cMedQA2) - ä¸­æ–‡åŒ»ç–—é—®ç­”æ•°æ®é›†
- [webMedQA](https://github.com/hejunqing/webMedQA) - ç½‘ç»œåŒ»ç–—é—®ç­”æ•°æ®é›†

ä¸‹è½½åå°†æ–‡ä»¶æ”¾åˆ° `data/raw/` ç›®å½•ã€‚

### æ­¥éª¤ 2ï¼šæ•°æ®é¢„å¤„ç†

```bash
python scripts/preprocess_data.py
```

**åŠŸèƒ½**ï¼š
- æ ¼å¼åŒ–ï¼šå°†ä¸åŒæ ¼å¼çš„åŸå§‹æ•°æ®ç»Ÿä¸€è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
- æ¸…æ´—ï¼šè¿‡æ»¤æ‰é•¿åº¦ä¸åˆé€‚ã€æ ¼å¼é”™è¯¯çš„æ ·æœ¬
- åˆ’åˆ†ï¼šæŒ‰ 8:1:1 æ¯”ä¾‹åˆ’åˆ†è®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›†

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `data/processed/train.json` - è®­ç»ƒé›†ï¼ˆ80%ï¼‰
- `data/processed/dev.json` - éªŒè¯é›†ï¼ˆ10%ï¼‰
- `data/processed/test.json` - æµ‹è¯•é›†ï¼ˆ10%ï¼‰

**å¯é€‰å‚æ•°**ï¼š
```bash
# æŒ‡å®šåŸå§‹æ•°æ®è·¯å¾„
python scripts/preprocess_data.py --raw_data ./data/raw/medical_qa.json

# æŒ‡å®šè¾“å‡ºç›®å½•
python scripts/preprocess_data.py --output_dir ./data/processed

# é™åˆ¶æ ·æœ¬æ•°é‡ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
python scripts/preprocess_data.py --max_samples 1000

# è®¾ç½®éšæœºç§å­
python scripts/preprocess_data.py --seed 42
```

**æ•°æ®æ¸…æ´—è§„åˆ™**ï¼š
- æœ€å°é•¿åº¦ï¼š10 å­—ç¬¦
- æœ€å¤§é•¿åº¦ï¼š512 å­—ç¬¦
- å¿…é¡»åŒ…å« `instruction`ã€`input`ã€`output` ä¸‰ä¸ªå­—æ®µ
- è‡ªåŠ¨å»é™¤ç©ºç™½å­—ç¬¦

### æ­¥éª¤ 3ï¼šå‡†å¤‡ä¸åŒè§„æ¨¡çš„æ•°æ®é›†

```bash
python scripts/prepare_data_splits.py
```

**åŠŸèƒ½**ï¼š
- ä»å®Œæ•´è®­ç»ƒé›†ä¸­éšæœºé‡‡æ ·ï¼Œç”Ÿæˆä¸åŒè§„æ¨¡çš„è®­ç»ƒé›†
- ç”¨äºå®éªŒå¯¹æ¯”æ•°æ®è§„æ¨¡å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `data/processed/train_1k.json` - 1,000 ä¸ªæ ·æœ¬
- `data/processed/train_5k.json` - 5,000 ä¸ªæ ·æœ¬
- `data/processed/train_10k.json` - 10,000 ä¸ªæ ·æœ¬

**å¯é€‰å‚æ•°**ï¼š
```bash
# æŒ‡å®šå®Œæ•´è®­ç»ƒé›†è·¯å¾„
python scripts/prepare_data_splits.py --train_file ./data/processed/train.json

# æŒ‡å®šè¾“å‡ºç›®å½•
python scripts/prepare_data_splits.py --output_dir ./data/processed

# è®¾ç½®éšæœºç§å­ï¼ˆç¡®ä¿å¯å¤ç°ï¼‰
python scripts/prepare_data_splits.py --seed 42
```

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

### æ ‡å‡†æ ¼å¼

æ‰€æœ‰é¢„å¤„ç†åçš„æ•°æ®æ–‡ä»¶é‡‡ç”¨ç»Ÿä¸€çš„ JSON æ ¼å¼ï¼š

```json
[
  {
    "instruction": "å›ç­”åŒ»ç–—å¥åº·é—®é¢˜",
    "input": "æ„Ÿå†’äº†åº”è¯¥åƒä»€ä¹ˆè¯ï¼Ÿ",
    "output": "æ„Ÿå†’çš„æ²»ç–—éœ€è¦æ ¹æ®ç—‡çŠ¶é€‰æ‹©åˆé€‚çš„è¯ç‰©..."
  },
  {
    "instruction": "å›ç­”åŒ»ç–—å¥åº·é—®é¢˜",
    "input": "é«˜è¡€å‹æ‚£è€…é¥®é£Ÿéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ",
    "output": "é«˜è¡€å‹æ‚£è€…é¥®é£Ÿåº”æ³¨æ„ï¼š1. ä½ç›é¥®é£Ÿ..."
  }
]
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `instruction` | string | ä»»åŠ¡æŒ‡ä»¤ï¼Œæè¿°æ¨¡å‹éœ€è¦å®Œæˆçš„ä»»åŠ¡ | "å›ç­”åŒ»ç–—å¥åº·é—®é¢˜" |
| `input` | string | ç”¨æˆ·è¾“å…¥çš„é—®é¢˜æˆ–æŸ¥è¯¢ | "æ„Ÿå†’äº†åº”è¯¥åƒä»€ä¹ˆè¯ï¼Ÿ" |
| `output` | string | æœŸæœ›çš„æ¨¡å‹è¾“å‡ºï¼ˆç­”æ¡ˆï¼‰ | "æ„Ÿå†’çš„æ²»ç–—éœ€è¦æ ¹æ®..." |

### åŸå§‹æ•°æ®æ ¼å¼å…¼å®¹

é¢„å¤„ç†è„šæœ¬æ”¯æŒå¤šç§åŸå§‹æ•°æ®æ ¼å¼ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼š

```python
# æ ¼å¼1ï¼šæ ‡å‡†æ ¼å¼ï¼ˆæ— éœ€è½¬æ¢ï¼‰
{"instruction": "...", "input": "...", "output": "..."}

# æ ¼å¼2ï¼šquestion-answer æ ¼å¼
{"question": "...", "answer": "..."}
# è½¬æ¢ä¸ºï¼š
{"instruction": "å›ç­”åŒ»ç–—å¥åº·é—®é¢˜", "input": "question", "output": "answer"}

# æ ¼å¼3ï¼šquery-response æ ¼å¼
{"query": "...", "response": "..."}
# è½¬æ¢ä¸ºï¼š
{"instruction": "å›ç­”åŒ»ç–—å¥åº·é—®é¢˜", "input": "query", "output": "response"}
```

## ğŸ¯ ä½¿ç”¨è¯´æ˜

### åœ¨è®­ç»ƒä¸­ä½¿ç”¨

åœ¨é…ç½®æ–‡ä»¶ï¼ˆ`configs/*.yaml`ï¼‰ä¸­æŒ‡å®šæ•°æ®è·¯å¾„ï¼š

```yaml
# ä½¿ç”¨å®Œæ•´è®­ç»ƒé›†
train_file: data/processed/train.json
val_file: data/processed/dev.json

# æˆ–ä½¿ç”¨ç‰¹å®šè§„æ¨¡çš„æ•°æ®é›†
train_file: data/processed/train_1k.json   # 1k æ ·æœ¬
train_file: data/processed/train_5k.json   # 5k æ ·æœ¬
train_file: data/processed/train_10k.json  # 10k æ ·æœ¬
```

### åœ¨è¯„ä¼°ä¸­ä½¿ç”¨

```bash
# ä½¿ç”¨éªŒè¯é›†è¯„ä¼°
python evaluate.py --test_file data/processed/dev.json

# ä½¿ç”¨æµ‹è¯•é›†è¯„ä¼°
python evaluate.py --test_file data/processed/test.json
```

### æ•°æ®åŠ è½½ç¤ºä¾‹

```python
from src.data_loader import MedicalQADataset

# åˆ›å»ºæ•°æ®é›†
dataset = MedicalQADataset(
    data_path="data/processed/train_1k.json",
    tokenizer=tokenizer,
    max_source_length=512,
    max_target_length=512
)

# è·å– Hugging Face Dataset å¯¹è±¡
hf_dataset = dataset.get_dataset()
```

## ğŸ“ˆ æ•°æ®é›†ç»Ÿè®¡

### é¢„æœŸæ•°æ®è§„æ¨¡

| æ•°æ®é›† | æ ·æœ¬æ•° | ç”¨é€” | æ–‡ä»¶å |
|--------|--------|------|--------|
| å®Œæ•´è®­ç»ƒé›† | ~40,000 | å®Œæ•´è®­ç»ƒ | `train.json` |
| éªŒè¯é›† | ~5,000 | è®­ç»ƒæ—¶éªŒè¯ | `dev.json` |
| æµ‹è¯•é›† | ~5,000 | æœ€ç»ˆè¯„ä¼° | `test.json` |
| 1k è®­ç»ƒé›† | 1,000 | å°è§„æ¨¡å®éªŒ | `train_1k.json` |
| 5k è®­ç»ƒé›† | 5,000 | ä¸­è§„æ¨¡å®éªŒ | `train_5k.json` |
| 10k è®­ç»ƒé›† | 10,000 | å¤§è§„æ¨¡å®éªŒ | `train_10k.json` |

### æ•°æ®è´¨é‡æŒ‡æ ‡

- **å¹³å‡é—®é¢˜é•¿åº¦**ï¼š20-50 å­—ç¬¦
- **å¹³å‡ç­”æ¡ˆé•¿åº¦**ï¼š100-300 å­—ç¬¦
- **é¢†åŸŸè¦†ç›–**ï¼šå¸¸è§ç–¾ç—…ã€ç”¨è¯æŒ‡å¯¼ã€å¥åº·å’¨è¯¢ã€é¢„é˜²ä¿å¥ç­‰

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ‰§è¡Œé¡ºåº

**å¿…é¡»æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œ**ï¼Œå¦åˆ™ä¼šå‡ºé”™ï¼š

1. âœ… å…ˆæ‰§è¡Œ `download_data.py`ï¼ˆä¸‹è½½åŸå§‹æ•°æ®ï¼‰
2. âœ… å†æ‰§è¡Œ `preprocess_data.py`ï¼ˆé¢„å¤„ç†æ•°æ®ï¼‰
3. âœ… æœ€åæ‰§è¡Œ `prepare_data_splits.py`ï¼ˆå‡†å¤‡ä¸åŒè§„æ¨¡æ•°æ®é›†ï¼‰

### ç£ç›˜ç©ºé—´

- åŸå§‹æ•°æ®ï¼š~200 MB
- é¢„å¤„ç†åæ•°æ®ï¼š~300 MB
- å»ºè®®é¢„ç•™ï¼š**è‡³å°‘ 1 GB** ç©ºé—²ç©ºé—´

### éšæœºç§å­

æ‰€æœ‰è„šæœ¬é»˜è®¤ä½¿ç”¨ `seed=42`ï¼Œç¡®ä¿ï¼š
- æ•°æ®åˆ’åˆ†å¯å¤ç°
- ä¸åŒè§„æ¨¡æ•°æ®é›†çš„é‡‡æ ·ä¸€è‡´
- å®éªŒç»“æœå¯å¯¹æ¯”

### æ•°æ®éšç§

- æœ¬é¡¹ç›®ä½¿ç”¨å…¬å¼€çš„åŒ»ç–—é—®ç­”æ•°æ®é›†
- æ•°æ®ä»…ç”¨äºå­¦æœ¯ç ”ç©¶å’Œæ¨¡å‹è®­ç»ƒ
- è¯·å‹¿ç”¨äºå®é™…åŒ»ç–—è¯Šæ–­

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸‹è½½æ•°æ®å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æœ‰ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š

1. **ä½¿ç”¨ç¤ºä¾‹æ•°æ®**ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰ï¼š
   ```bash
   python scripts/download_data.py --create_sample
   ```

2. **æ‰‹åŠ¨ä¸‹è½½**ï¼š
   - è®¿é—® [shibing624/medical](https://huggingface.co/datasets/shibing624/medical)
   - ä¸‹è½½æ•°æ®é›†å¹¶æ”¾åˆ° `data/raw/` ç›®å½•

3. **ä½¿ç”¨å¤‡é€‰æ•°æ®é›†**ï¼š
   - [cMedQA2](https://github.com/zhangsheng93/cMedQA2)
   - [webMedQA](https://github.com/hejunqing/webMedQA)

### Q2: å¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†å—ï¼Ÿ

**A**: å¯ä»¥ï¼åªéœ€ï¼š

1. å°†æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼ˆè§ä¸Šæ–‡"æ•°æ®æ ¼å¼è¯´æ˜"ï¼‰
2. ä¿å­˜ä¸º JSON æ–‡ä»¶
3. åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè·¯å¾„

ç¤ºä¾‹ï¼š
```json
[
  {
    "instruction": "ä½ çš„ä»»åŠ¡æè¿°",
    "input": "ç”¨æˆ·é—®é¢˜",
    "output": "æœŸæœ›ç­”æ¡ˆ"
  }
]
```

### Q3: æ•°æ®é¢„å¤„ç†æ—¶å‡ºç°ç¼–ç é”™è¯¯ï¼Ÿ

**A**: ç¡®ä¿ï¼š
- åŸå§‹æ•°æ®æ–‡ä»¶ä½¿ç”¨ UTF-8 ç¼–ç 
- Python è„šæœ¬ä¸­æŒ‡å®š `encoding='utf-8'`

### Q4: ä¸åŒè§„æ¨¡æ•°æ®é›†çš„é‡‡æ ·æ˜¯å¦æœ‰åï¼Ÿ

**A**: ä¸ä¼šã€‚é‡‡æ ·è¿‡ç¨‹ï¼š
1. ä½¿ç”¨å›ºå®šéšæœºç§å­ï¼ˆ42ï¼‰
2. å…ˆæ‰“ä¹±å®Œæ•´è®­ç»ƒé›†
3. æŒ‰é¡ºåºæˆªå–å‰ N ä¸ªæ ·æœ¬
4. ç¡®ä¿å¯å¤ç°æ€§å’Œæ— åæ€§

### Q5: éªŒè¯é›†å’Œæµ‹è¯•é›†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**: 
- **éªŒè¯é›†ï¼ˆdev.jsonï¼‰**ï¼šè®­ç»ƒè¿‡ç¨‹ä¸­ç”¨äºè°ƒå‚å’Œæ—©åœ
- **æµ‹è¯•é›†ï¼ˆtest.jsonï¼‰**ï¼šè®­ç»ƒå®Œæˆåç”¨äºæœ€ç»ˆè¯„ä¼°
- ä¸¤è€…æ•°æ®ä¸é‡å ï¼Œç¡®ä¿è¯„ä¼°å…¬å¹³æ€§

### Q6: æ•°æ®é‡ä¸è¶³ 10k æ€ä¹ˆåŠï¼Ÿ

**A**: å¦‚æœåŸå§‹æ•°æ®ä¸è¶³ï¼š
- è„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡æ— æ³•åˆ›å»ºçš„æ•°æ®é›†
- å¯ä»¥ä½¿ç”¨è¾ƒå°è§„æ¨¡çš„æ•°æ®é›†è¿›è¡Œå®éªŒ
- æˆ–è€…è¡¥å……å…¶ä»–åŒ»ç–—é—®ç­”æ•°æ®æº

## ğŸ“š æ•°æ®é›†æ¥æº

æœ¬é¡¹ç›®ä½¿ç”¨çš„åŒ»ç–—é—®ç­”æ•°æ®é›†æ¥è‡ªå¼€æºç¤¾åŒºï¼š

- **ä¸»è¦æ•°æ®é›†**ï¼š[shibing624/medical](https://huggingface.co/datasets/shibing624/medical)
- **è®¸å¯è¯**ï¼šApache 2.0
- **æ ·æœ¬æ•°é‡**ï¼šçº¦ 50,000 æ¡
- **æ•°æ®è´¨é‡**ï¼šç»è¿‡äººå·¥å®¡æ ¸å’Œæ¸…æ´—
- **é¢†åŸŸè¦†ç›–**ï¼šå¸¸è§ç–¾ç—…ã€ç”¨è¯ã€å¥åº·å’¨è¯¢ç­‰

### å¤‡é€‰æ•°æ®é›†

å¦‚æœéœ€è¦æ›´å¤šæ•°æ®ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **cMedQA2**ï¼šä¸­æ–‡åŒ»ç–—é—®ç­”æ•°æ®é›†ï¼ˆ10ä¸‡+é—®ç­”å¯¹ï¼‰
2. **webMedQA**ï¼šç½‘ç»œåŒ»ç–—é—®ç­”æ•°æ®é›†ï¼ˆ6ä¸‡+é—®ç­”å¯¹ï¼‰
3. **Chinese-medical-dialogue-data**ï¼šä¸­æ–‡åŒ»ç–—å¯¹è¯æ•°æ®é›†

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®ä¸» README](../README.md) - é¡¹ç›®æ•´ä½“è¯´æ˜
- [ä½¿ç”¨æŒ‡å—](../docs/ä½¿ç”¨æŒ‡å—.md) - è¯¦ç»†æ“ä½œæ­¥éª¤
- [å°ç»„åˆ†å·¥è¯´æ˜](../docs/å°ç»„åˆ†å·¥è¯´æ˜.md) - å›¢é˜Ÿåä½œæŒ‡å—

---

**æç¤º**ï¼šæ•°æ®å‡†å¤‡æ˜¯æ¨¡å‹è®­ç»ƒçš„ç¬¬ä¸€æ­¥ï¼Œè¯·ç¡®ä¿æŒ‰ç…§æ­¥éª¤æ­£ç¡®æ‰§è¡Œã€‚å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ä¸Šè¿°å¸¸è§é—®é¢˜æˆ–è”ç³»é¡¹ç›®è´Ÿè´£äººã€‚
